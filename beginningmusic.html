<!DOCTYPE html>
<html>
<head>
    <title>Jolly 8-Bit Loop</title>
    <style>
        body { 
            background: #fdf0d5; 
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; 
            height: 100vh; font-family: 'Courier New', monospace;
            color: #669bbc; margin: 0;
        }
        .pixel-box { 
            border: 4px solid #f11a7b; padding: 30px; 
            background: white; box-shadow: 8px 8px 0px #669bbc;
            text-align: center;
        }
        button {
            padding: 10px 20px; font-size: 1rem; cursor: pointer;
            background: #f11a7b; color: white; border: none;
            font-weight: bold; font-family: 'Courier New', monospace;
        }
        button:hover { background: #c1121f; }
        .character { font-size: 2.5rem; margin-bottom: 10px; display: inline-block; }
        .bounce { animation: bounce 0.6s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <div class="pixel-box">
        <div id="sprite" class="character">üçÑ</div>
        <h2 style="margin: 10px 0;">Happy Stroll</h2>
        <button id="playBtn" onclick="toggleMusic()">‚ñ∂ Start Stroll</button>
    </div>

<script>
    let isPlaying = false;
    let nextNoteTime = 0;
    let timerID = null;
    let currentStep = 0;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // A jolly, bouncy F-Major melody
    const melody = [
        349.23, 0, 440.00, 523.25, // F4, skip, A4, C5
        587.33, 523.25, 440.00, 392.00 // D5, C5, A4, G4
    ];

    function playNote(freq, time, duration, type, vol) {
        if (freq === 0) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        
        osc.type = type;
        osc.frequency.setValueAtTime(freq, time);
        
        gain.gain.setValueAtTime(vol, time);
        gain.gain.exponentialRampToValueAtTime(0.0001, time + duration);
        
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        osc.start(time);
        osc.stop(time + duration);
    }

    function scheduler() {
        while (nextNoteTime < audioCtx.currentTime + 0.1) {
            const secondsPerBeat = 0.2; // The "jolly" speed
            
            // The Melody (Soft Square wave for that 'toy' feel)
            playNote(melody[currentStep], nextNoteTime, 0.3, 'square', 0.04);
            
            // The "Heartbeat" (Warm Triangle bass)
            if (currentStep % 2 === 0) {
                playNote(174.61, nextNoteTime, 0.4, 'triangle', 0.06); // Low F
            }

            nextNoteTime += secondsPerBeat;
            currentStep = (currentStep + 1) % melody.length;
        }
        timerID = requestAnimationFrame(scheduler);
    }

    function toggleMusic() {
        const btn = document.getElementById('playBtn');
        const sprite = document.getElementById('sprite');
        
        if (!isPlaying) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isPlaying = true;
            nextNoteTime = audioCtx.currentTime;
            scheduler();
            btn.innerText = "‚ñ† Stop Stroll";
            sprite.classList.add('bounce');
        } else {
            isPlaying = false;
            cancelAnimationFrame(timerID);
            btn.innerText = "‚ñ∂ Start Stroll";
            sprite.classList.remove('bounce');
        }
    }
</script>
</body>
</html>